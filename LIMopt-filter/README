Uses same code as LIMopt.
